# ---- Build UI (Vite/React) ----
FROM node:20-alpine AS build
ARG APP_PATH=apps/checkout
WORKDIR /src

COPY ${APP_PATH}/package*.json ./
RUN npm ci

COPY ${APP_PATH}/ ./
RUN npm run build

# ---- Serve via Tomcat ----
FROM tomcat:9.0-jdk17-temurin
RUN rm -rf /usr/local/tomcat/webapps/*
COPY --from=build /src/dist/ /usr/local/tomcat/webapps/ROOT/
EXPOSE 8080
CMD ["catalina.sh", "run"]
